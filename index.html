<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üí© Pigeon Plop: Mobile Chaos!</title>
    
    <style>
        /* BASE & TYPOGRAPHY */
        body {
            font-family: 'Arial Black', Gadget, sans-serif;
            background-color: #e0f7fa; /* Light Cyan */
            color: #1a237e; /* Deep Blue Text */
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 10px;
        }

        header h1 {
            color: #ff6e40; /* Deep Orange */
            text-shadow: 3px 3px #ffe0b2; /* Light Orange shadow */
            font-size: 1.8em;
            margin-bottom: 10px;
        }

        /* LAYOUT (MOBILE FIRST) */
        #game-container {
            width: 100%;
            max-width: 500px; /* Max size for good mobile fit */
            display: flex;
            flex-direction: column;
            gap: 15px;
            background: white;
            padding: 15px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
        }

        /* GAME BOARD (5x5 Grid) */
        #game-board {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(5, 1fr);
            width: 100%;
            aspect-ratio: 1 / 1;
            border: 4px solid #4caf50; /* Green Border */
            background-color: #c8e6c9; /* Light Green Grass */
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }

        .square {
            border: 1px solid #81c784;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.8em; /* Slightly smaller for mobile */
            position: relative;
            cursor: pointer;
            transition: background-color 0.1s;
        }
        .square:active { background-color: #a5d6a7; } /* Feedback on touch */

        /* Board Features */
        .statue { background-color: #90a4ae; color: #37474f; } /* Statue (Goal) */
        .fountain { background-color: #4fc3f7; } /* Fountain (Hazard) */
        .hotdog { background-color: #ffb74d; } /* Hot Dog Stand (Lure target) */

        /* Pieces */
        .pigeon {
            position: absolute;
            font-size: 1.5em;
            font-weight: bold;
            z-index: 10;
            text-shadow: 1px 1px 0 white;
            transition: transform 0.3s;
        }
        .pigeon-red { color: #f44336; }
        .pigeon-blue { color: #2196f3; }

        /* STATUS & HAND */
        #player-status, #action-area {
            background-color: #e3f2fd; /* Very Light Blue */
            padding: 10px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        #hand-display {
            margin-top: 10px;
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* 2 cards per row */
            gap: 8px;
        }

        .card-button {
            padding: 10px 8px;
            border: 3px solid #673ab7; /* Deep Purple Border */
            background-color: #ede7f6; /* Lighter Purple */
            color: #4527a0;
            border-radius: 8px;
            font-size: 0.9em;
            font-weight: bold;
            text-align: center;
            cursor: pointer;
            pointer-events: none;
            opacity: 0.5;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        .card-button.active {
            opacity: 1;
            background-color: #b39ddb;
            pointer-events: auto;
            transform: scale(1.05);
        }
        .card-button:active.active { background-color: #9575cd; }
        
        /* DICE & ACTIONS */
        #dice-display {
            font-size: 40px;
            font-weight: bold;
            border: 4px solid #ff9800; /* Amber */
            width: 60px;
            height: 60px;
            line-height: 60px;
            margin: 10px auto;
            border-radius: 8px;
            background-color: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        #roll-button {
            width: 100%;
            padding: 15px 10px;
            font-size: 1.1em;
            cursor: pointer;
            background-color: #ff5722;
            color: white;
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 0 #e64a19; /* 3D effect */
            transition: all 0.1s;
        }
        #roll-button:active {
            box-shadow: 0 2px 0 #e64a19;
            transform: translateY(2px);
        }
        
        /* MULTIPLAYER/STORAGE */
        #online-area {
            display: flex;
            flex-direction: column;
            gap: 10px;
            text-align: center;
            padding: 10px 0;
            border-top: 2px dashed #90caf9;
        }
        #room-code-display {
            font-size: 1.3em;
            color: #00bcd4;
            padding: 8px;
            border: 2px dashed #00bcd4;
            display: inline-block;
            border-radius: 5px;
            background-color: #e0f7fa;
        }
        .small-btn {
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: bold;
            width: 100%;
        }

        /* --- INSTRUCTION MODAL --- */
        .modal {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.7); /* Black w/ opacity */
        }
        .modal-content {
            background-color: #fff;
            margin: 10% auto; /* Centered, mobile friendly */
            padding: 20px;
            border: 3px solid #4caf50;
            width: 90%;
            max-width: 400px;
            border-radius: 15px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.5);
        }
        .close-btn {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close-btn:hover, .close-btn:focus {
            color: #f44336;
            text-decoration: none;
            cursor: pointer;
        }
        .rule-list li { margin-bottom: 5px; }

    </style>
</head>
<body>

    <header>
        <h1>üí© Pigeon Plop!</h1>
    </header>

    <div id="game-container">
        
        <div id="game-board">
            <div class="square" data-coord="A1"></div>
            <div class="square" data-coord="A2"></div>
            <div class="square statue" data-coord="A3">üèõÔ∏è</div>
            <div class="square" data-coord="A4"></div>
            <div class="square" data-coord="A5"></div>

            <div class="square" data-coord="B1"></div>
            <div class="square hotdog" data-coord="B2">üå≠</div>
            <div class="square" data-coord="B3"></div>
            <div class="square" data-coord="B4"></div>
            <div class="square" data-coord="B5"></div>
            
            <div class="square fountain" data-coord="C1">‚õ≤</div>
            <div class="square" data-coord="C2"></div>
            <div class="square statue" data-coord="C3">üèõÔ∏è</div>
            <div class="square" data-coord="C4"></div>
            <div class="square fountain" data-coord="C5">‚õ≤</div>
            
            <div class="square" data-coord="D1"></div>
            <div class="square" data-coord="D2"></div>
            <div class="square" data-coord="D3"></div>
            <div class="square hotdog" data-coord="D4">üå≠</div>
            <div class="square" data-coord="D5"></div>
            
            <div class="square" data-coord="E1"></div>
            <div class="square" data-coord="E2"></div>
            <div class="square statue" data-coord="E3">üèõÔ∏è</div>
            <div class="square" data-coord="E4"></div>
            <div class="square" data-coord="E5"></div>

            <div class="pigeon pigeon-red" data-id="R1" data-coord="A5" style="grid-area: 1 / 5;">üê¶</div>
            <div class="pigeon pigeon-blue" data-id="B1" data-coord="E1" style="grid-area: 5 / 1;">ü¶Ö</div>
        </div>

        <div id="player-status">
            <h2>Your Hand</h2>
            <p>Pigeons Placed: <span id="placed-pigeons">0</span> / 5 | Roll Target: <span id="roll-target-info">Roll the dice!</span></p>
            <div id="hand-display">
                </div>
            <button onclick="document.getElementById('instructions-modal').style.display='block'" 
                    style="margin-top: 10px; background-color: #5c6bc0; color: white;" class="small-btn">Show Instructions</button>
        </div>

        <div id="action-area">
            <div id="dice-display">
                <span id="current-roll">?</span>
            </div>
            <button id="roll-button">ROLL THE CHAOS DICE!</button>
            <p id="game-message" style="font-weight: bold; color: #d32f2f;">Welcome! Roll to begin.</p>
        </div>

        <div id="online-area">
            <p>Room Code: <div id="room-code-display">ABCDEF</div></p>
            <button id="save-button" class="small-btn" style="background-color: #388e3c; color: white;">Save Game</button>
        </div>

    </div>

    <div id="instructions-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="document.getElementById('instructions-modal').style.display='none'">&times;</span>
            <h2>Pigeon Plop Rules üê¶üí©</h2>
            <hr>
            <p><strong>Goal:</strong> Be the first to place 5 of your Pigeons (üê¶) onto the Statue squares (üèõÔ∏è).</p>
            
            <h3>How to Play:</h3>
            <ul class="rule-list">
                <li><strong>Roll the Dice:</strong> The number (1-5) corresponds to the position of a card in your Hand (left-to-right).</li>
                <li><strong>Mandatory Action:</strong> If a number matches a card, you **MUST** click the active card to perform the action. The card is then discarded.</li>
                <li><strong>Chaos Roll (6):</strong> Roll a 6, and you **draw a new random card**. If your hand is full, you must click a card to discard it.</li>
            </ul>

            <h3>Card Actions:</h3>
            <ul class="rule-list">
                <li>**Plop üí©:** Place an unplaced Pigeon onto an adjacent empty square or directly onto an open Statue.</li>
                <li>**Bread Crumbs üçû:** Lure an opponent's Pigeon one space towards the nearest Hot Dog Stand (üå≠).</li>
                <li>**Fountain Flush üíß:** All pieces next to a Fountain (‚õ≤) are moved back 2 spaces.</li>
                <li>**Seagull ü¶Ö:** Swap the position of any two empty/non-statue squares on the board.</li>
            </ul>
        </div>
    </div>

    <script>
        const DOM = {
            roll: document.getElementById('current-roll'),
            message: document.getElementById('game-message'),
            rollButton: document.getElementById('roll-button'),
            handDisplay: document.getElementById('hand-display'),
            placedCount: document.getElementById('placed-pigeons'),
            rollTargetInfo: document.getElementById('roll-target-info'),
            roomCode: document.getElementById('room-code-display'),
            modal: document.getElementById('instructions-modal')
        };

        // --- GAME STATE ---
        const CARD_TYPES = ["Plop üí©", "Bread Crumbs üçû", "Fountain Flush üíß", "Seagull ü¶Ö", "Random Draw ‚ùì"];
        const MAX_HAND_SIZE = 5;

        let gameState = {
            currentPlayer: 'red',
            playerHands: {
                'red': ["Plop üí©", "Bread Crumbs üçû", "Fountain Flush üíß"],
            },
            placedPigeons: 0,
            lastRoll: 0,
            roomCode: 'SINGLE'
        };

        // --- Utility Functions ---

        function generateRoomCode() {
            const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = '';
            for (let i = 0; i < 6; i++) {
                code += characters.charAt(Math.floor(Math.random() * characters.length));
            }
            gameState.roomCode = code;
            DOM.roomCode.textContent = code;
        }

        function updateDisplay() {
            // Update the Hand buttons
            DOM.handDisplay.innerHTML = '';
            const currentHand = gameState.playerHands[gameState.currentPlayer];
            
            currentHand.forEach((card, index) => {
                const button = document.createElement('button');
                button.textContent = card;
                button.className = 'card-button';
                button.dataset.cardIndex = index;

                const isRollMatch = gameState.lastRoll > 0 && gameState.lastRoll <= 5 && index === gameState.lastRoll - 1;
                const isDiscardPhase = gameState.lastRoll === 6 && currentHand.length >= MAX_HAND_SIZE;
                
                if (isRollMatch || isDiscardPhase) {
                    button.classList.add('active');
                    if (isRollMatch) DOM.rollTargetInfo.textContent = `REQUIRED: ${card}`;
                    button.onclick = () => handleCardAction(index, isDiscardPhase);
                } else if (gameState.lastRoll === 6 && card === "Random Draw ‚ùì") {
                    // Always allow the 'Random Draw' card if it's in hand and roll is 6
                    button.classList.add('active');
                    button.onclick = () => handleCardAction(index);
                }
                
                DOM.handDisplay.appendChild(button);
            });
            
            if (gameState.lastRoll === 0) DOM.rollTargetInfo.textContent = 'Roll the dice!';

            DOM.placedCount.textContent = gameState.placedPigeons;
        }

        function drawCard() {
            // Randomly select a card type
            const newCard = CARD_TYPES[Math.floor(Math.random() * CARD_TYPES.length)]; 
            const hand = gameState.playerHands[gameState.currentPlayer];

            if (hand.length < MAX_HAND_SIZE) {
                hand.push(newCard);
                DOM.message.textContent = `CHAOS ROLL! You drew a new card: ${newCard}!`;
            } else {
                DOM.message.textContent = `CHAOS ROLL! Hand is full! Click a card to discard it.`;
            }
        }

        function handleRoll() {
            if (gameState.lastRoll !== 0) {
                DOM.message.textContent = "Complete your action or discard first!";
                return;
            }

            const roll = Math.floor(Math.random() * 6) + 1;
            gameState.lastRoll = roll;
            DOM.roll.textContent = roll;
            
            if (roll === 6) {
                drawCard();
            } else if (gameState.playerHands[gameState.currentPlayer].length > roll - 1) {
                DOM.message.textContent = `Rolled ${roll}. Action MUST be taken!`;
            } else {
                DOM.message.textContent = `Rolled ${roll}. No card in position ${roll}! Turn passed.`;
                endTurn();
            }

            updateDisplay();
        }

        function handleCardAction(cardIndex, isDiscard = false) {
            const cardName = gameState.playerHands[gameState.currentPlayer][cardIndex];

            if (isDiscard) {
                gameState.playerHands[gameState.currentPlayer].splice(cardIndex, 1);
                DOM.message.textContent = `Discarded ${cardName}. Turn ended.`;
            } else {
                // --- Simple Placeholder Logic for Card Effects ---
                if (cardName === "Plop üí©" && gameState.placedPigeons < 5) {
                    gameState.placedPigeons++;
                    DOM.message.textContent = "Pigeon Plop! One more pigeon placed! (Need full movement logic)";
                } else if (cardName === "Random Draw ‚ùì") {
                    drawCard();
                    DOM.message.textContent = "Random Draw used. Card consumed. Draw again!";
                } else {
                    DOM.message.textContent = `Used ${cardName}. Chaos ensues! (Requires full movement logic)`;
                }
                
                // Card is consumed unless it's a special case (like a bonus roll/draw)
                if (cardName !== "Random Draw ‚ùì") {
                    gameState.playerHands[gameState.currentPlayer].splice(cardIndex, 1);
                }
            }
           
            endTurn();
        }

        function endTurn() {
            gameState.lastRoll = 0;
            // gameState.currentPlayer = gameState.currentPlayer === 'red' ? 'blue' : 'red'; // For multiplayer/AI
            
            if (gameState.placedPigeons >= 5) {
                DOM.message.textContent = `üéâ WINNER! You are the Pigeon Baron!`;
                DOM.rollButton.disabled = true;
            }
            
            updateDisplay();
        }

        // --- Local Storage Functions ---

        function saveGame() {
            localStorage.setItem('pigeonPlopSave', JSON.stringify(gameState));
            DOM.message.textContent = `Game state SAVED! Code: ${gameState.roomCode}`;
        }

        function loadGame() {
            const savedState = localStorage.getItem('pigeonPlopSave');
            if (savedState) {
                gameState = JSON.parse(savedState);
                DOM.message.textContent = `Game LOADED! It's your turn.`;
            } else {
                generateRoomCode();
                DOM.message.textContent = "Welcome, Baron! Roll to start the Plop!";
                // Show instructions automatically on first load
                DOM.modal.style.display='block';
            }
            updateDisplay();
        }

        // --- Event Listeners ---
        DOM.rollButton.addEventListener('click', handleRoll);
        document.getElementById('save-button').addEventListener('click', saveGame);
        
        // Initial load
        document.addEventListener('DOMContentLoaded', loadGame);

        // Close modal when clicking outside of it
        window.onclick = function(event) {
            if (event.target == DOM.modal) {
                DOM.modal.style.display = "none";
            }
        }
    </script>
</body>
</html>
