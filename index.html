<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üêç Snakes & Boosters Online</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #fce4ec;
  display: flex;
  flex-direction: column;
  align-items: center;
  margin: 0;
  padding: 10px;
}
header h1 {
  color: #d81b60;
  text-shadow: 2px 2px #f8bbd0;
}
#game-container {
  width: 100%;
  max-width: 500px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  background: white;
  padding: 15px;
  border-radius: 20px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.3);
}
#game-board {
  display: grid;
  grid-template-columns: repeat(10, 1fr);
  grid-template-rows: repeat(10, 1fr);
  width: 100%;
  aspect-ratio: 1 / 1;
  border: 4px solid #4a148c;
  background-color: #f3e5f5;
  border-radius: 10px;
  position: relative;
}
.square {
  border: 1px solid #ce93d8;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 0.7em;
  position: relative;
  font-weight: bold;
}
.booster { background-color: #a5d6a7; color: green; }
.hazard { background-color: #ef9a9a; color: red; }
.skip { background-color: #fff59d; color: orange; }
.double { background-color: #90caf9; color: blue; }
.token {
  position: absolute;
  width: 8%;
  height: 8%;
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 0.7em;
  color: white;
  font-weight: bold;
  transition: all 0.5s ease-in-out;
}
button {
  padding: 10px 15px;
  border-radius: 10px;
  cursor: pointer;
  margin-top: 5px;
}
#dice-display {
  font-size: 2em;
  width: 50px;
  height: 50px;
  margin: 0 auto;
  line-height: 50px;
  border: 3px solid #ff4081;
  border-radius: 8px;
  background: white;
}
</style>
</head>

<body>
<header><h1>üêç Snakes & Boosters Online</h1></header>

<div id="game-container">
  <div id="mode-selection">
    <p>Select Mode:</p>
    <button id="single-btn">Single Player vs AI</button>
    <button id="multi-btn">Multiplayer Online</button>
  </div>

  <div id="online-room" style="display:none;">
    <p>Enter Room Code: <input type="text" id="room-code-input" maxlength="6"></p>
    <button id="join-room-btn">Join Room</button>
    <button id="create-room-btn">Create Room</button>
    <p>Your Room Code: <span id="room-display"></span></p>
  </div>

  <div id="player-status" style="display:none;">
    <h2>Current Turn: <span id="current-player-display"></span></h2>
    <p id="players-positions"></p>
    <p id="game-message">Roll the dice to start!</p>
  </div>

  <div id="game-board"></div>

  <div id="action-area" style="display:none;">
    <div id="dice-display">?</div>
    <button id="roll-button">ROLL DICE</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
import { getDatabase, ref, set, get, onValue } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDezuEzLaVrbFrYtFdHLjS-A-s-1yhduLY",
  authDomain: "game-794ad.firebaseapp.com",
  databaseURL: "https://game-794ad-default-rtdb.firebaseio.com/",
  projectId: "game-794ad",
  storageBucket: "game-794ad.appspot.com",
  messagingSenderId: "804274377887",
  appId: "1:804274377887:web:205f5ec40874f04b6c3eaa"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// --- GAME LOGIC ---
const BOARD_SIZE = 100;
const SPECIAL_SQUARES = {
  4:{type:'booster',target:35},
  13:{type:'booster',target:45},
  27:{type:'booster',target:76},
  49:{type:'booster',target:88},
  32:{type:'hazard',target:2},
  55:{type:'hazard',target:12},
  80:{type:'hazard',target:38},
  98:{type:'hazard',target:54},
};

let gameState = { players:{}, currentPlayer:"", roomCode:"", status:"waiting" };
let tokens = {};

const board = document.getElementById('game-board');
const msg = document.getElementById('game-message');
const dice = document.getElementById('dice-display');
const rollBtn = document.getElementById('roll-button');

function getCoords(n){
  const row = Math.floor((n-1)/10);
  let col = (n-1)%10;
  const r = 9-row;
  if(r%2!==0) col = 9-col;
  return { row:r, col:col };
}

function renderBoard(){
  board.innerHTML="";
  for(let i=1;i<=BOARD_SIZE;i++){
    const sq=document.createElement('div');
    sq.className="square";
    sq.textContent=i;
    if(SPECIAL_SQUARES[i]) sq.classList.add(SPECIAL_SQUARES[i].type);
    board.appendChild(sq);
  }
  for(const p in tokens) board.appendChild(tokens[p]);
}

function updateTokens(){
  for(const p in gameState.players){
    const pos=gameState.players[p].position;
    const coords=getCoords(pos);
    const token=tokens[p];
    token.style.transform=`translate(${coords.col*10}%,${coords.row*10}%)`;
  }
  document.getElementById('players-positions').textContent =
    Object.entries(gameState.players).map(([k,v])=>`${v.name}: ${v.position}`).join(" | ");
  document.getElementById('current-player-display').textContent = gameState.currentPlayer;
}

function rollDice(){
  const roll=Math.floor(Math.random()*6)+1;
  dice.textContent=roll;
  movePlayer(gameState.currentPlayer, roll);
}

function movePlayer(p, roll){
  let pos=gameState.players[p].position+roll;
  if(pos>BOARD_SIZE) pos=gameState.players[p].position;
  gameState.players[p].position=pos;
  if(SPECIAL_SQUARES[pos]){
    gameState.players[p].position=SPECIAL_SQUARES[pos].target;
  }
  if(gameState.players[p].position===BOARD_SIZE){
    msg.textContent=`üéâ ${gameState.players[p].name} Wins!`;
    return;
  }
  updateTokens();
  nextTurn();
}

function nextTurn(){
  const keys=Object.keys(gameState.players);
  let i=keys.indexOf(gameState.currentPlayer);
  gameState.currentPlayer=keys[(i+1)%keys.length];
  updateTokens();
  const cp=gameState.players[gameState.currentPlayer];
  if(cp.isAI){
    msg.textContent=`AI rolling...`;
    setTimeout(()=>rollDice(),1000);
  }else{
    msg.textContent=`${cp.name}'s turn`;
  }
}

// ----- MODES -----
function startSinglePlayer(){
  document.getElementById('mode-selection').style.display='none';
  setupGame({RED:{position:1,name:"You",isAI:false},BLUE:{position:1,name:"AI",isAI:true}});
}

function setupGame(players){
  gameState.players=players;
  gameState.currentPlayer=Object.keys(players)[0];
  document.getElementById('player-status').style.display='block';
  document.getElementById('action-area').style.display='block';

  for(const p in players){
    const t=document.createElement('div');
    t.className='token';
    t.style.backgroundColor=p.toLowerCase();
    t.textContent=p[0];
    tokens[p]=t;
  }
  renderBoard();
  updateTokens();

  if(gameState.players[gameState.currentPlayer].isAI){
    setTimeout(()=>rollDice(),1000);
  }
}

function startMultiplayer(){
  document.getElementById('mode-selection').style.display='none';
  document.getElementById('online-room').style.display='block';
}

function createRoom(){
  const code=Math.random().toString(36).substring(2,8).toUpperCase();
  gameState={players:{RED:{position:1,name:"Host",isAI:false}},currentPlayer:"RED",roomCode:code,status:"ongoing"};
  set(ref(db,'rooms/'+code),gameState);
  document.getElementById('room-display').textContent=code;
  loadRoom(code);
}

function joinRoom(){
  const code=document.getElementById('room-code-input').value.toUpperCase();
  if(!code)return;
  loadRoom(code);
}

function loadRoom(code){
  const r=ref(db,'rooms/'+code);
  onValue(r,snap=>{
    const data=snap.val();
    if(!data)return;
    gameState=data;
    document.getElementById('online-room').style.display='none';
    document.getElementById('player-status').style.display='block';
    document.getElementById('action-area').style.display='block';
    for(const p in gameState.players){
      if(!tokens[p]){
        const t=document.createElement('div');
        t.className='token';
        t.style.backgroundColor=p.toLowerCase();
        t.textContent=p[0];
        tokens[p]=t;
      }
    }
    renderBoard();
    updateTokens();
  });
}

// attach button listeners
document.getElementById('single-btn').addEventListener('click', startSinglePlayer);
document.getElementById('multi-btn').addEventListener('click', startMultiplayer);
document.getElementById('create-room-btn').addEventListener('click', createRoom);
document.getElementById('join-room-btn').addEventListener('click', joinRoom);
rollBtn.addEventListener('click', rollDice);
</script>
</body>
</html>
